description "Display cast service"

start on started dbus and started urfkill
stop on stopping dbus

respawn

script
	if [ -f /system/build.prop ] ; then
		# Wait for Android properties to be set
		while [ "$(getprop init.svc.upstart-watcher)" != "running" ]; do sleep 0.2; done

		iface=`getprop wifi.direct.interface`
		if [ "$iface" != "" ] ; then
			export AETHERCAST_DEDICATED_P2P_INTERFACE=$iface
			# FIXME this might not be true for all devices but it should
			# not cause any for those which doesn't need any firmware as
			# the Android WiFi firmware loader should just pass through
			export AETHERCAST_NEED_FIRMWARE=1
		fi
	fi

	exec /usr/sbin/aethercast
end script
